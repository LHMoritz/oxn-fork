# yaml-language-server: $schema=experiment_schema.json
experiment:
  name: "latest"
  version: 0.0.1
  orchestrator: kubernetes
  services:
    jaeger:
      name: astronomy-shop-jaeger-query
      namespace: system-under-evaluation
    prometheus:
      [
        {
          name: astronomy-shop-prometheus-server,
          namespace: system-under-evaluation,
          target: sue,
        },
        {
          name: kube-prometheus-kube-prome-prometheus,
          namespace: oxn-external-monitoring,
          target: oxn,
        },
      ]
  responses:
    - name: frontend_traces
      type: trace
      service_name: frontend
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: recommendation_traces
      type: trace
      service_name: recommendationservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: frontend_proxy_traces
      type: trace
      service_name: frontend-proxy
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: featureflagservice_traces
      type: trace
      service_name: featureflagservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: accountingservice_traces
      type: trace
      service_name: accountingservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: adservice_traces
      type: trace
      service_name: adservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: checkoutservice_traces
      type: trace
      service_name: checkoutservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: currencyservice_traces
      type: trace
      service_name: currencyservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: emailservice_traces
      type: trace
      service_name: emailservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: frauddetectionservice_traces
      type: trace
      service_name: frauddetectionservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: paymentservice_traces
      type: trace
      service_name: paymentservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: productcatalogservice_traces
      type: trace
      service_name: productcatalogservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: quoteservice_traces
      type: trace
      service_name: quoteservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: shippingservice_traces
      type: trace
      service_name: shippingservice
      left_window: 10s
      right_window: 10s
      limit: 1
    - name: cartservice_traces
      type: trace
      service_name: cartservice
      left_window: 10s
      right_window: 10s
      limit: 1

 
  treatments:
    - package_lost_treatment:
        action: kubernetes_loss
        params:
          {
            namespace: system-under-evaluation,
            label_selector: app.kubernetes.io/name,
            label: astronomy-shop-recommendationservice,
            loss_percentage: 15.0,
            duration: 1m,
            interface: eth0,
          }
  sue:
    compose: opentelemetry-demo/docker-compose.yml
    exclude: [loadgenerator]
    required: [
        {
          namespace: system-under-evaluation,
          name: astronomy-shop-prometheus-server,
        },
      ] # {namespace: monitoring, name: not-running-service}
    #required: [{namespace: monitoring, name: grafana}, {namespace: monitoring, name: node-exporter}]
  loadgen:
    run_time: 5m
    max_users: 50
    spawn_rate: 10
    locust_files:
      - "/opt/oxn/locust/locust_basic_interaction.py"
      - "/opt/oxn/locust/locust_otel_demo.py"
    target:
      name: astronomy-shop-frontendproxy
      namespace: system-under-evaluation
      port: 8080
